---
- package: High-Throughput Sequencing Lib from Samtools
  name: htslib 
  versions: !include biotools_versions.yaml
  version: "{{ versions.htslib }}"
  extension: tar.gz
  vendor_source: https://github.com/samtools/htslib/archive/{{ version }}.tar.gz
  description: >
    HTSLIB {{ version }}.  HTSlib implements a generalized BAM index, 
    with file extension csi (coordinate-sorted index). 
  root: "{{ pkg_defaults.app_path }}/{{ name }}/{{ version }}"
  addfile: 
    - filter-requires-{{ name }}.sh 
  build:
    configure: ./configure 
    configure_args: --prefix={{ root }}
    modules: 
      - gcc/{{ versions.gcc }}
    pkgmake: make 
    target: 
  install:
     makeinstall: >
       mkdir -p $(ROOT){{ root }};
       make install DESTDIR=$(ROOT)
     installextra: $(INSTALL) -m 644  README* COPYING AUTHORS $(ROOT){{ root }} 
  files:
    -  "{{ root }}"
  requires:
    - gcc_{{ versions.gcc }} 
  provides:
    - libhts.so.1()(64bit)
  rpm:  
    ## redefine the __spec_install_post macro to load the correct modules so that 
    ## brp-python-bytecompile can access libraries and correct version of python
     extras: | 
       %define _python_bytecompile_errors_terminate_build 0\n\
       %define __spec_install_post \
       %{?__debug_package:%{__debug_install_post}}\
       module load {{ build.modules }};\
       %{__arch_install_post}\
       %{__os_install_post}\
       module unload {{ build.modules }}\
       %{nil}\n\
       %define _use_internal_dependency_generator 0\n\
       %define __find_requires %{_builddir}/%{name}-%{version}/filter-requires-{{name}}.sh\n\
       %define __find_provides %{_rpmconfigdir}/find-provides

