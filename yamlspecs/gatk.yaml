!include common.yaml
---
- package: Genome Analysis Toolkit
  name: gatk 
  version: "{{versions.gatk}}"
  extension: zip
  vendor_source: https://github.com/broadinstitute/gatk/releases/download/{{version}}/{{name}}-{{version}}.{{extension}}
  description: >
    GATK {{version}}. Genome Analysis Toolkit 
  build:
    configure: echo
    modules: 
      - java/{{versions.java}}
    pkgmake: echo 
    target: 
  install:
     makeinstall: >
       mkdir -p $(ROOT){{root}};
       $(INSTALL) gatk $(ROOT){{root}};
       $(INSTALL) -m 0644 gatk*.* GATK* README.md $(ROOT){{root}};
       $(TAR) cf - gatkdoc scripts | (cd $(ROOT){{root}}; tar xf -)
     installextra: 
  requires:
    - jre = {{versions.java}} 

# first line undefines repacking of existing jar files
  rpm:
    extras: |
      %define __jar_repack 0\n\
      %define _python_bytecompile_errors_terminate_build 0\n\
      %define __python `module load {{build.modules}}; which python; module unload {{build.modules}}`\n\
      %define __spec_install_post \
      %{?__debug_package:%{__debug_install_post}}\
      module load {{ build.modules }};\
      %{__arch_install_post}\
      %{__os_install_post}\
      module unload {{ build.modules }}\
      %{nil} 
